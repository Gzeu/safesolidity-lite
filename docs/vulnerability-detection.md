# Vulnerability Detection Engine

## Pattern-Based Detection

SafeSolidity Lite detectează vulnerabilități prin pattern matching și analiză statică.

## Supported Vulnerabilities

### 1. Reentrancy Attacks
```solidity
// VULNERABLE
function withdraw() external {
    (bool success,) = msg.sender.call{value: balances[msg.sender]}("");
    require(success, "Transfer failed");
    balances[msg.sender] = 0; // State change after external call!
}
```

**Pattern**: `.call{value:` followed by state changes
**Severity**: CRITICAL

### 2. tx.origin Usage
```solidity
// VULNERABLE
function checkAuth() external view returns (bool) {
    return tx.origin == owner; // Should use msg.sender
}
```

**Pattern**: `\btx\.origin\b`
**Severity**: HIGH

### 3. Timestamp Dependence
```solidity
// VULNERABLE
function isExpired() external view returns (bool) {
    return block.timestamp > deadline; // Can be manipulated
}
```

**Pattern**: `\b(block\.timestamp|timestamp)\b`
**Severity**: MEDIUM

### 4. Unchecked External Calls
```solidity
// VULNERABLE
function transfer(address to, uint amount) external {
    to.call{value: amount}(""); // Return value not checked
}
```

**Pattern**: `\.call.*\s*;` without return value check
**Severity**: HIGH

### 5. Arithmetic Overflow (Pre-0.8)
```solidity
// VULNERABLE (Solidity < 0.8)
pragma solidity ^0.7.0;
function add(uint a, uint b) public pure returns (uint) {
    return a + b; // Can overflow
}
```

**Pattern**: Arithmetic operations în Solidity < 0.8
**Severity**: HIGH

## Rule Configuration

```typescript
export const auditRules: Record<string, Rule> = {
  REENTRANCY: { id: "REENTRANCY", enabled: true, severity: "CRITICAL" },
  TX_ORIGIN: { id: "TX_ORIGIN", enabled: true, severity: "HIGH" },
  TIMESTAMP: { id: "TIMESTAMP", enabled: true, severity: "MEDIUM" },
  UNCHECKED_CALL: { id: "UNCHECKED_CALL", enabled: true, severity: "HIGH" },
  ARITH_OVERFLOW: { id: "ARITH_OVERFLOW", enabled: true, severity: "HIGH" },
};
```

## Extension Points

- **Custom Rules**: Adaugă pattern-uri noi în `vulnerability-patterns.ts`
- **Severity Tuning**: Modifică severity în `audit-rules.ts`
- **WASM Integration**: Înlocuiește rule-based cu Slither WASM când disponibil
